!function(){var a={capitalize:function(a){return a?a.charAt(0).toUpperCase()+a.substring(1).toLowerCase():null},urlBase64Decode:function(a){var b=a.replace("-","+").replace("_","/");switch(b.length%4){case 0:break;case 2:b+="==";break;case 3:b+="=";break;default:throw"Illegal base64url string!"}return window.atob(b)}};angular.module("auth0",["auth0.storage","auth0.service","auth0.interceptor","auth0.utils"]),angular.module("auth0.utils",[]).factory("authUtils",["$rootScope","$q",function(b,c){return a.safeApply=function(a){var c=b.$root.$$phase;"$apply"===c||"$digest"===c?a&&angular.isFunction(a)&&a():b.$apply(a)},a.applied=function(b){return function(){a.safeApply(function(){b.apply(null,arguments)})}},a.promisify=function(a,b){return angular.isFunction(a)?function(d){d=Array.prototype.slice.call(arguments);var e=c.defer(),f=function(a,b,c){a&&e.reject(a),c=Array.prototype.slice.call(arguments,1),e.resolve(c.length>1?c:b)};return d.push(angular.isFunction(b)?b(f):f),a.apply(null,d),e.promise.spread=e.promise.spread||function(a,b){return e.promise.then(function(b){return Array.isArray(b)?a.apply(null,b):a(b)},b)},e.promise}:void 0},a}]),angular.module("auth0.interceptor",[]).factory("authInterceptor",["$rootScope","$q","$injector",function(a,b,c){return{request:function(a){if(!c.has("auth"))return a;var b=c.get("auth");return a.headers=a.headers||{},b.idToken&&!a.headers.Authorization&&(a.headers.Authorization="Bearer "+b.idToken),a},responseError:function(c){return 401===c.status&&a.$broadcast("auth0.forbidden",c),b.reject(c)}}}]),angular.module("auth0.storage",["ngCookies"]).service("authStorage",["$cookieStore",function(a){this.store=function(b,c,d){a.put("idToken",b),a.put("accessToken",c),d&&a.put("state",d)},this.get=function(){return{idToken:a.get("idToken"),accessToken:a.get("accessToken"),state:a.get("state")}},this.remove=function(){a.remove("idToken"),a.remove("accessToken"),a.remove("state")}}]),angular.module("auth0.service",["auth0.storage","auth0.utils"]).provider("auth",function(){var b={callbackOnLocationHash:!0},c=this;this.init=function(a,c){if(!c&&angular.isUndefined(window.Auth0Widget)&&angular.isUndefined(window.Auth0))throw new Error("You must add either Auth0Widget.js or Auth0.js");if(!a)throw new Error("You must set options when calling init");this.loginUrl=a.loginUrl,this.loginState=a.loginState,this.clientID=a.clientID,this.sso=a.sso;var d=c;!d&&angular.isDefined(window.Auth0Widget)&&(d=window.Auth0Widget),!d&&angular.isDefined(window.Auth0)&&(d=window.Auth0),this.auth0lib=new d(angular.extend(b,a)),this.auth0lib.getClient?(this.auth0js=this.auth0lib.getClient(),this.isWidget=!0):(this.auth0js=this.auth0lib,this.isWidget=!1)},this.eventHandlers={},this.on=function(a,b){this.eventHandlers[a]||(this.eventHandlers[a]=[]),this.eventHandlers[a].push(b)};var d=["loginSuccess","loginFailure","logout","forbidden"];angular.forEach(d,function(b){c["add"+a.capitalize(b)+"Handler"]=function(a){c.on(b,a)}}),this.$get=["$rootScope","$q","$injector","authStorage","$window","$location","authUtils",function(b,d,e,f,g,h,i){var j={isAuthenticated:!1},k=function(a){return c.eventHandlers[a]},l=function(a,b){angular.forEach(k(a)||[],function(a){e.invoke(a,j,b)})},m=function(a,b,c,d){f.store(a,b,c);var e=j.getProfile(a),g={idToken:a,accessToken:b,state:c,isAuthenticated:!0};return angular.extend(j,g),l("loginSuccess",angular.extend({profile:e,locationEvent:d},g)),e};a.safeApply=function(a){var c=b.$root.$$phase;"$apply"===c||"$digest"===c?a&&angular.isFunction(a)&&a():b.$apply(a)},a.applied=function(b){return function(){a.safeApply(function(){b.apply(null,arguments)})}},a.promisify=function(a,b){return angular.isFunction(a)?function(c){c=Array.prototype.slice.call(arguments);var e=d.defer(),f=function(a,b,c){a&&e.reject(a),c=Array.prototype.slice.call(arguments,1),e.resolve(c.length>1?c:b)};return c.push(angular.isFunction(b)?b(f):f),a.apply(null,c),e.promise.spread=e.promise.spread||function(a,b){return e.promise.then(function(b){return Array.isArray(b)?a.apply(null,b):a(b)},b)},e.promise}:void 0},b.$on("$locationChangeStart",function(a){var b=c.auth0lib.parseHash(g.location.hash);if(!j.isAuthenticated){if(b&&b.id_token)return void m(b.id_token,b.access_token,b.state,a);var d=f.get();if(d&&d.idToken)return void m(d.idToken,d.accessToken,d.state,a);c.sso&&c.auth0js.getSSOData(i.applied(function(a,b){b.sso&&j.signin({popup:!1,connection:b.lastUsedConnection.strategy},c.auth0js)}))}}),b.$on("auth0.forbidden",function(a,b){l("forbidden",{response:b})}),c.loginUrl&&b.$on("$routeChangeStart",function(a,b){b.$$route&&b.$$route.requiresLogin&&(j.isAuthenticated||h.path(c.loginUrl))}),c.loginState&&b.$on("$stateChangeStart",function(a,b){b.data&&b.data.requiresLogin&&(j.isAuthenticated||(a.preventDefault(),e.get("$state").go(c.loginState)))}),j.config=c;var n=function(a){var b=k("loginSuccess");if(!(a.popup||a.username||b&&0!==b.length))throw new Error("You must define a loginSuccess handlerif not using popup mode or not doing ro call because that means you are doing a redirect")};return j.hasTokenExpired=function(a){if(!a)return!0;var b=a.split(".");if(3!==b.length)return!0;var c=i.urlBase64Decode(b[1]);if(!c)return!0;try{c=JSON.parse(c)}catch(d){return!0}if(!c.exp)return!0;var e=new Date(0);return e.setUTCSeconds(c.exp),isNaN(e)?!0:e.valueOf()>(new Date).valueOf()?!1:!0},j.getToken=function(a,b){b=b||{scope:"openid"};var d=i.promisify(c.auth0js.getDelegationToken,i.applied);return d(a,j.idToken,b).then(function(a){return a.id_token})},j.refreshToken=function(a){return j.getToken(c.clientID,a)},j.signin=function(a,b){a=a||{},n(a);var e=b||c.auth0lib,f=i.promisify(e.signin,i.applied),g=c.isWidget?f(a,null):f(a);return g.spread(function(a,b,c,d){return m(b,c,d)})["catch"](function(a){return l("loginFailure",{error:a}),d.reject(a)})},j.signout=function(){f.remove(),j.profile=null,j.idToken=null,j.state=null,j.accessToken=null,j.isAuthenticated=!1},j.getProfile=function(a){var b=i.promisify(c.auth0lib.getProfile,i.applied);return b(a||j.idToken).then(function(a){return j.profile=a,a})},j}]})}();